{% load static %}
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>To-Do List App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  {# Flatpickr CSS #}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>
  <link rel="stylesheet" href="{% static 'css/style.css' %}" />
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-white min-h-screen transition-colors">
  <div id="particles-js" class="fixed top-0 left-0 w-full h-full -z-10"></div>
  <div class="max-w-7xl mx-auto p-4"> {# Increased max-width for the overall container #}
    <div class="flex justify-between items-center mb-4">
      <button id="toggleDarkMode" class="text-sm px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded">
        🌙 / ☀️
      </button>
    </div>

    {# Moved To-Do List header to the top level #}
    <h1 class="text-3xl font-bold mb-8 text-center">📝 To-Do List</h1>

    {# Main flex container for two columns - added items-start for top alignment #}
    <div class="flex flex-col md:flex-row gap-8 md:items-start">

      <div class="w-full md:w-1/2"> {# Left column for form, task list #}
        <div class="mb-4 space-y-2 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg shadow"> {# Added padding, bg, shadow for form #}
          <h3 class="text-xl font-semibold mb-2">Add New Task</h3>
          <input id="taskInput" type="text" placeholder="Add a new task..." class="w-full px-4 py-2 rounded border dark:border-gray-700 bg-white dark:bg-gray-700 focus:outline-none" />
          <label class="block">
            <span class="text-sm block">Reminder Time:</span>
            <input id="reminderInput" type="datetime-local" class="w-full px-4 py-2 rounded border dark:border-gray-700 bg-white dark:bg-gray-700 focus:outline-none" />
          </label>

          <label class="block">
            <span class="text-sm block">Repeat:</span>
            <select id="repeatInput" class="w-full px-4 py-2 rounded border dark:border-gray-700 bg-white dark:bg-gray-700">
              <option value="">No Repeat</option>
              <option value="daily">Repeat Daily</option>
              <option value="weekly">Repeat Weekly</option>
            </select>
          </label>

          <label class="block">
            <span class="text-sm block">Tags (comma-separated):</span>
            <input id="tagInput" type="text" placeholder="e.g., Work, Urgent" class="w-full px-4 py-2 rounded border dark:border-gray-700 bg-white dark:bg-gray-700 focus:outline-none" />
          </label>

          <button onclick="addTask()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Add Task</button>
        </div>

        <div class="mb-8 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg shadow">
            <h3 class="text-xl font-semibold mb-2">My Tasks</h3>
            <ul id="taskList" class="space-y-2 h-80 overflow-y-auto pr-2"></ul>
        </div>
      </div>

      <div class="w-full md:w-1/2"> {# Right column for progress stats, email setup, and calendar #}
        <div id="progressStats" class="mb-8 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg shadow"> {# Added padding, bg, shadow #}
          </div>

        <div class="p-4 bg-gray-100 dark:bg-gray-800 rounded-lg shadow mb-8"> {# Added padding, bg, shadow and mb-8 for spacing #}
            <h3 class="text-xl font-semibold mb-2">Email Reminders</h3>
            <label class="flex items-center space-x-2 mb-2">
                <input type="checkbox" id="reminderToggle" onchange="toggleEmailField()" class="w-5 h-5" />
                <span>Get email reminders</span>
            </label>

            <div id="emailField" class="mt-2 hidden">
                <input id="emailInput" type="email" placeholder="Enter your email" class="w-full px-4 py-2 border rounded dark:bg-gray-700 dark:border-gray-700 bg-white" />
                <button onclick="saveEmail()" class="mt-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded w-full">Save Email</button>
            </div>
        </div>

        <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg shadow mt-4"> {# Removed mb-8 and added mt-4 as email section now has mb-8 #}
            <h3 class="text-xl font-semibold mb-2">View Past Tasks</h3>
            <input type="text" id="calendarInput" placeholder="Select a date" class="w-full px-4 py-2 rounded border dark:border-gray-700 bg-white dark:bg-gray-700 focus:outline-none" />
        </div>
      </div>
    </div>
  </div>

  <div id="oldTasksModal" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50 p-4">
    <div class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow-xl w-full max-w-md relative text-gray-800 dark:text-white">
      <button id="closeModalBtn" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 dark:hover:text-gray-300 text-2xl font-bold">&times;</button>
      <div id="oldTasksModalContent">
        </div>
    </div>
  </div>

  {# Flatpickr JS #}
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="{% static 'js/main.js' %}"></script>
  <script>
    let currentTheme = localStorage.getItem("theme") || "dark";

    // Set initial theme
    document.documentElement.classList.toggle("dark", currentTheme === "dark");

    // Init particles with correct color
    function loadParticles(color) {
      particlesJS("particles-js", {
        particles: {
          number: {
            value: 80
          },
          color: {
            value: color
          },
          shape: {
            type: "circle",
            stroke: {
              width: 0,
              color: "#000000"
            }
          },
          opacity: {
            value: 0.3,
            random: true
          },
          size: {
            value: 3,
            random: true
          },
          line_linked: {
            enable: true,
            distance: 150,
            color: color,
            opacity: 0.3,
            width: 1
          },
          move: {
            enable: true,
            speed: 1.5,
            direction: "none",
            out_mode: "bounce"
          }
        },
        interactivity: {
          detect_on: "canvas",
          events: {
            onhover: {
              enable: true,
              mode: "grab"
            },
            onclick: {
              enable: true,
              mode: "push"
            }
          },
          modes: {
            grab: {
              distance: 200,
              line_linked: {
                opacity: 0.4
              }
            },
            push: {
              particles_nb: 4
            }
          }
        },
        retina_detect: true
      });
    }

    // Clear existing particles and reinit
    function reloadParticles() {
      const color = document.documentElement.classList.contains("dark") ? "#ffffff" : "#000000";
      document.querySelector("#particles-js").innerHTML = ""; // clear canvas
      loadParticles(color);
    }

    // Theme toggle handler
    const toggleDarkMode = document.getElementById("toggleDarkMode");
    toggleDarkMode.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      const isDark = document.documentElement.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      reloadParticles();
    });

    // Init particles on first load
    window.addEventListener("DOMContentLoaded", () => {
      reloadParticles();
    });
  </script>

</body>
</html>